# 计算机网络

参考资料：

- [详解HTTPS是如何确保安全性的](https://blog.csdn.net/wx_962464/article/details/51043069)
- https://www.zhihu.com/question/338939262/answer/778573750

## SSL

### 总述

SSL称为**安全套接字协议**，是为网络通信提供安全及数据完整性的一种安全协议。SSL在传输层与应用层之间对网络连接进行加密。位于端口**443**。

### 对称加密和非对称加密

我们要想了解SSL，首先得了解对称加密和非对称加密。

#### 对称加密

##### 描述

需要对加密和解密使用相同密钥的加密算法。

例如：

假设有一个加密算法A, 这个算法将每一位的ASCII码加2形成密文。

用户甲: 明文 ABCD  **-- 加密 -->**  密文 CDEF 

用户乙: 密文CDEF  **-- 解密 -->**  明文 ABCD

我们可以发现，对称加密需要对加密和解密使用相同密钥（可以看成加解密的指令）的加密算法。它的安全性去决议加密算法和密钥的管理。

##### 优缺点

效率高，由于不适合在网上传输，秘钥的维护较为麻烦。

#### 非对称加密

##### 描述

非对称加密算法需要两个密钥：公开密钥（publickey，简称公钥）和私有密钥（privatekey，简称私钥）。公钥与私钥是一对，如果用公钥对数据进行加密，只有用对应的私钥才能解密。因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。

例如：

- A要向B发送信息，A和B都要产生一对用于加密和解密的**公钥和私钥**。
- A的私钥保密，A的公钥告诉B；B的私钥保密，B的公钥告诉A。
- A要给B发送信息时，A用B的公钥加密信息，因为A知道B的公钥。
- A将这个消息发给B（已经用B的公钥加密消息）
- B收到这个消息后，B用自己的私钥解密A的消息。其他所有收到这个报文的人都无法解密，因为只有B才有B的私钥。

##### 优缺点

有较高的安全性，但效率低。

一个优化方案是**结合对称加密算法**，例如如果数据比较大，使用对方的公钥来加密效率会很低，但是我们可以使用对称秘钥，但是使用对方的公钥来加密这个对称秘钥，就可以提高效率（因为加密这个数据量不算大的公钥效率高），这些描述可以概括为“**给锁上锁**”。

### SSL的过程

上面说到，SSL在传输层与应用层之间对网络连接进行加密。

在发送方，SSL接收应用层的数据，对数据进行加密，然后把加密的数据送往TCP套接字。

在接收方，SSL从TCP套接字读取数据，解密后把数据交给应用层。

浏览器在访问web服务器的资源时，安装了**证书**的web服务器会交给浏览器一个公钥，之后浏览器生成一个对称加密秘钥，然后用web服务器的公钥进行加密，web服务器可以对这个对称加密秘钥进行解密。在此之后，浏览器和web服务器就通过这个对称加密秘钥来通信。

 ### 数字证书

#### 总述

对于请求方来说，它怎么能确定它所得到的公钥一定是从目标主机那里发布的，而且没有被篡改过呢？亦或者请求的目标主机本本身就从事窃取用户信息的不正当行为呢？这时候，我们需要有一个权威的值得信赖的第三方机构(一般是由政府审核并授权的机构)来统一对外发放主机机构的公钥，只要请求方这种机构获取公钥，就避免了上述问题的发生。

#### 颁发过程

用户首先**产生自己的密钥对**，并将公共密钥及部分个人身份信息传送给认证中心。认证中心在核实身份后，将执行一些必要的步骤，以确信请求确实由用户发送而来，然后，认证中心将发给用户一个**数字证书**，该证书内包含**用户的个人信息和他的公钥信息**，同时还附有认证中心的**签名信息**(根证书私钥签名)。用户就可以使用自己的数字证书进行相关的各种活动。数字证书由独立的证书发行机构发布，数字证书各不相同，每种证书可提供不同级别的可信度。

#### 如何验证

浏览器/操作系统默认内置了CA的根证书。根证书包含了这个CA的公钥。

如果:

- 证书颁发的机构是伪造的：浏览器不认识，直接认为是危险证书

- 如果伪造的证书颁发的机构是确实存在的，于是根据CA名，找到对应内置的CA根证书、CA的公钥。用CA的公钥，对伪造的证书的摘要进行解密，发现解不了, 认为是危险证书。

- 对于篡改的证书，使用CA的公钥对数字签名进行解密得到摘要A,然后再根据签名的Hash算法计算出证书的摘要B，对比A与B，若相等则正常，若不相等则是被篡改过的。

- 证书可在其过期前被吊销，通常情况是该证书的私钥已经失密。较新的浏览器如Chrome、Firefox、Opera和Internet Explorer都实现了在线证书状态协议（OCSP）以排除这种情形：浏览器将网站提供的证书的序列号通过OCSP发送给证书颁发机构，后者会告诉浏览器证书是否还是有效的。

## HTTP状态码

### 分类

HTTP状态码由三个十进制数字组成，第一个十进制数字定义了状态码的类型，后两个数字没有分类的作用。HTTP状态码共分为5种类型。

| 分类 | 分类描述                                           |
| :--- | :------------------------------------------------- |
| 1**  | 信息，服务器收到请求，需要**请求者继续执行操作**   |
| 2**  | **成功**，操作被成功接收并处理                     |
| 3**  | **重定向**，需要进一步的操作以完成请求             |
| 4**  | **客户端错误**，请求包含语法错误或无法完成请求     |
| 5**  | **服务器错误**，服务器在处理请求的过程中发生了错误 |

### 常见的状态码

| HTTP状态码 | 英文名称      | 中文描述                                                     |
| :--------- |------------------------ | :----------------------------------------------------------- |
| 100 | Continue | 客户端征询服务器状况，如果服务器同意可以返回100，同时客户端可以继续请求。常见的案例是在上传大文件的情况下，客户端先上传请求头部，交给服务端校验权限、文件名称合法性，如果符合，返回100，客户端再传输剩下的数据。否则返回400之类的错误，直接终止服务 |
| 200        | OK          | 请求成功                                                     |
| 304        | Not Modified          | 未修改。所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会**缓存**访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源 |
| 400 | Bad Request | 客户端请求的语法错误，服务器无法理解 |
| 401 | Unauthorized      | 请求要求用户的身份认证                   |
| 403 | Forbidden | 服务器理解请求客户端的请求，但是拒绝执行此请求 |
| 404 | Not Found | 服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置"您所请求的资源无法找到"的个性页面 |
| 405 | Method Not Allowed | 客户端请求中的方法被禁止 |
| 500 | Internal Server Error | 服务器内部错误，无法完成请求                                 |
| 502 | Bad Gateway | 作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应 |

## GET和POST

#### 幂等性

GET我们可以理解为**读取**一个资源。比如Get到一个html文件。反复读取不应该对访问的数据有副作用。比如”GET一下，用户就下单了，返回订单已受理“，这是不可接受的。**没有副作用**被称为“幂等“。

由于GET请求为读取，我们可以在浏览器端或者代理端做到**缓存**。

而对于POST，它是不幂等的，也就是说我们不能随意多次执行，也就不能做到缓存。

#### 安全性

貌似GET比POST安全，因为GET把数据全部保存在URL中，然而对攻击者来说，GET、POST都不安全，因为HTTP协议是明文传输的，无论url、headers、body。

