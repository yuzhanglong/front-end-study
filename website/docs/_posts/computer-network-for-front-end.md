---
date: 2021-3-21

tags:

- 前端基础
- 计算机网络

---

# 前端计算机网络必知必会 -- 应用层

[[toc]]

## DNS -- 域名系统

### 概念

DNS 解析其实就是用你的域名来定位真正的 IP 地址，就像拜访朋友要先知道别人家怎么走一样，Internet 上当一台主机要访问另外一台主机时，必须首先获知其地址，TCP/IP 中的 IP
地址是由四段以“.”分开的数字组成，记起来总是不如名字那么方便，所以，就采用了**DNS**来管理名字和 IP 的对应关系。

### 流程

DNS 解析本质上是一个**迭代查询**和**递归查询**的过程，假设我的主机要访问`docs.yuzzl.top`这个网站，需要获得它的 IP，来看看这个 DNS 解析流程：
![](http://cdn.yuzzl.top/blog/20201108194011.png)

### DNS 缓存

当某 DNS 服务器接收到一个应答之后，它会将这个内容缓存到服务器上。还是上面的图，假如另一台电脑使用同样的本地 DNS 服务器访问`docs.yuzzl.top`，那么本地 DNS
服务器查询缓存，然后直接返回`docs.yuzzl.top`的 IP 地址（如果没有过期的话）。

## HTTP

### 常见请求方法

**OPTIONS**

HTTP 的 OPTIONS 方法用于获取目的资源所支持的通信选项，其用法有二种：

- 检测服务器所支持的请求方法

![](http://cdn.yuzzl.top/blog/20210321193708.png)

- CORS 中的预检请求

CORS 通过一种叫**预检请求**（preflighted request）的服务器验证机制，允许使用自定义头部、除 GET 、POST、HEAD（这三个也被称为**简单请求**）
之外的方法，以及不同请求体内容类型。在要发送涉及上述某种高级选项的请求时，会先向服务器发送一个“预检”请求。这个请求使用 OPTIONS 方法发送并包含以下头部：

- **Origin**：与简单请求相同

- **Access-Control-Request-Method**：请求希望使用的方法

- **Access-Control-Request-Headers**：（可选）要使用的逗号分隔的自定义头部列表。

例如下面的请求报文(省略了一部分无关头部)：

```http request
OPTIONS /user/user_info HTTP/1.1
Host: 47.106.202.255:8081
Connection: keep-alive
Accept: */*
Access-Control-Request-Method: GET
Access-Control-Request-Headers: authorization,loading
Origin: http://yuzzl.top
```

在这个请求发送之后，服务器确认是否允许，然后在响应头部附带以下内容：

- **Access-Control-Allow-Origin**：支持请求的路径。
- **Access-Control-Allow-Methods**：允许的方法（逗号分隔的列表）。
- **Access-Control-Allow-Headers**：服务器允许的头部（逗号分隔的列表）。
- **Access-Control-Max-Age**：缓存预检请求的秒数 (预检请求也是有缓存机制的)。

例如下面的响应报文：

```http request
Access-Control-Allow-Credentials: true
Access-Control-Allow-Headers: authorization, loading
Access-Control-Allow-Methods: POST,GET,PUT,OPTIONS,DELETE
Access-Control-Allow-Origin: http://docs.yuzzl.top
Access-Control-Max-Age: 3600
```

### 状态码

### 分类

HTTP 状态码由三个十进制数字组成，第一个十进制数字定义了状态码的类型，后两个数字没有分类的作用。HTTP 状态码共分为 5 种类型：

| 分类 | 分类描述                                           |
| :--- | :------------------------------------------------- |
| 1**  | **临时响应**，服务器收到请求，需要**请求者继续执行操作**   |
| 2**  | **成功**，操作被成功接收并处理                     |
| 3**  | **重定向**，需要进一步的操作以完成请求             |
| 4**  | **客户端错误**，请求包含语法错误或无法完成请求     |
| 5**  | **服务器错误**，服务器在处理请求的过程中发生了错误 |

### 常见的状态码

| HTTP 状态码 | 英文名称      | 中文描述                                                     |
| :--------- |------------------------ | :----------------------------------------------------------- |
| 100 | Continue | 客户端征询服务器状况，如果服务器同意可以返回 100，同时客户端可以继续请求。常见的案例是在上传大文件的情况下，客户端先上传请求头部，交给服务端校验权限、文件名称合法性，如果符合，返回 100，客户端再传输剩下的数据。否则返回 400 之类的错误，直接终止服务 |
| 200        | OK          | 请求成功                                                     |
| 304        | Not Modified          | 所请求的资源未修改，和缓存机制有关 |
| 400 | Bad Request | 客户端请求的语法错误，服务器无法理解 |
| 401 | Unauthorized      | 请求要求用户的身份认证                   |
| 403 | Forbidden | 服务器理解请求客户端的请求，但是拒绝执行此请求 |
| 404 | Not Found | 服务器无法根据客户端的请求找到资源 |
| 405 | Method Not Allowed | 客户端请求中的方法被禁止 |
| 500 | Internal Server Error | 服务器内部错误，无法完成请求                                 |
| 501 | Not Implemented | 此请求方法不被服务器支持且无法被处理。       |
| 502 | Bad Gateway | 作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应 |

#### 安全性

貌似 GET 比 POST 安全，因为 GET 把数据全部保存在 URL 中，然而对攻击者来说，GET、POST 都不安全，因为 HTTP 协议是明文传输的，无论 url、headers、body。

### 代理

代理服务器本身不生产内容，它作为一个中继转发上下游的请求。

#### 正向代理

![](http://cdn.yuzzl.top/blog/20210322114604.png)

- 1 由于某些原因（例如防火墙）无法访问 3
- 此时我们通过 2（正向代理）访问 3
- 正向代理做到了隐藏客户端的身份
- 一些抓包工具的原理就是利用了正向代理服务

#### 反向代理

![](http://cdn.yuzzl.top/blog/20210322114749.png)

- 1 访问 2，2 将 1 的请求转发给 3
- 反向代理可以用来隐藏服务器的身份、实现负载均衡

## CDN

### 概念

CDN 的全称是 Content Delivery Network，即**内容分发网络**。

它指的是一组分布在各个地区的服务器。这些服务器存储着数据的副本，因此服务器可以根据哪些服务器与用户距离最近，来满足数据的请求。

### CDN 流程

用户通过浏览器指令检索一个特定的资源时，CDN 必须截获这个请求，以便能够：

- 确定此时适合用于该客户的 CDN 服务器集群。
- 将客户的请求重定向到该集群的某一台服务器。

结合下面这个真实案例，我们来了解一下 CDN 的整个流程，假定一个内容提供商**yuzzl.top**，雇用了第三方 CDN 公司**七牛云**来向他的客户提供资源。在 **yuzzl.top** 的网页上，每个资源都被指定了一个 URL。

![](http://cdn.yuzzl.top/blog/20201101223427.png)

接下来我们来介绍一下**集群选择策略**，这是任何 CDN 部署的核心。

### 集群选择策略

集群的选择对应了上图的**步骤 4**，在 CDN 权威服务器得知了本地 DNS 服务器的地址之后，CDN 需要基于该地址选择一个适当的集群。CDN 一般采用专用的集群选择策略。常见的方案有：

**地理上最为临近**

使用商用地理位置数据库，每个本地 DNS 的 IP 地址都映射到某个地理位置。CDN 通过数据库的查询找到地理位置上最为接近的集群。

**实时测量**

**地理上最为临近**的方案对于众多用户来说表现得很好，但是对于部分用户，不一定起到最好效果。因为**地理最邻近的集群可能并不是沿着网络路径最近的集群**。另外，还有可能用户的本地 DNS
的地理位置距离客户的位置比较大，导致我们地理位置的判断失去意义。

CDN 可以通过对其集群和客户之间的时延和丢包性能执行周期性的实时测量。

针对实时测量，我们有以下几种常见方案：

- 让 CDN 能够让它的集群周期性地向位于全世界的所有本地 DNS 发送探测分组（例如 ping 报文）。缺点在于部分本地 DNS 拒绝来自 CDN 服务器的探测。
- 利用近期客户和 CDN 服务器的交互信息来进行测量。缺点在于时不时地需要将用户重定向到优化过的集群。从而导致性能下降。

