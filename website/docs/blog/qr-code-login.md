# 基于 Koa 和 WebSocket 实现二维码登录

扫描二维码登录这个场景经常遇到，本文将介绍二维码登录的实现原理，并使用 Koa 框架实现一个简单的二维码登录 DEMO。

## 二维码登录原理

二维码登录的实现流程如下，红色线表示 WebSocket 连接，白色线表示 http(s) 连接：

![](http://cdn.yuzzl.top/blog/20210113224809.png)

可以看出，基于 **WebSocket**，我们可以弥补 http 无状态的缺陷，让服务端和客户端建立一次持久的连接，而这个连接状态的改变和用户的扫描情况、确认情况息息相关。

整个过程的核心主要有下面三个：

- 唯一标识 **uuid**：通过这个 uuid，我们可以将客户端和移动端进行关联，客户端和移动端持有相同的 uuid，这是它们互相关联、登录结果能正确分发的基础。另外，为了保证安全性，这个 uuid 应该有**过期时间**。
- 移动端已存在的 **token**：通过 token 有效性的验证，我们可以知道是哪个用户在扫码。
- 二维码：是 uuid 的载体。

:::tip

你也可以用 **ajax 轮询**来替代 Websocket，前者是服务端向客户端主动推送状态，后者是客户端定期向服务端查询状态）.
:::

## 实现二维码登录

下面我们将以 Koa 框架为基础，来实现二维码登录。


